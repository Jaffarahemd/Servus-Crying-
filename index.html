<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Servus Yadav Replyer</title>
<style>
body{background:#0c0c0c;color:#eaeaea;font-family:Poppins,Arial;text-align:center;padding:20px;}
h1{color:#00ff9d;margin-bottom:6px;}
input,select,button{margin:6px;padding:10px;border-radius:6px;border:none;font-size:15px;}
button{background:#00ff9d;color:#000;font-weight:600;cursor:pointer;}
.card{background:#111;padding:20px;border-radius:10px;box-shadow:0 0 8px #00ff9d;display:inline-block;}
pre{background:#000;padding:10px;border-radius:6px;text-align:left;max-width:760px;margin:auto;white-space:pre-wrap;}
.small{font-size:13px;color:#cfcfcf;}
.row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px;}
</style>
</head>
<body>
<h1>Servus Yadav Replyer ‚öôÔ∏è</h1>

<div class="card" style="width:90%;max-width:900px">
  <div style="text-align:left">
    <p><b>Enter Your WhatsApp Number (with country code)</b></p>
    <input id="number" placeholder="+919876543210" />
    <button onclick="pair()">üîó Generate Pairing Code</button>

    <p><b>Select Target Type</b></p>
    <select id="targetType">
      <option>Number</option>
      <option>Group UID</option>
    </select>
    <input id="targetValue" placeholder="Enter target number or group UID" />

    <p><b>Message Prefix (optional)</b></p>
    <input id="prefix" placeholder="Hi there..." />

    <p><b>Delay (seconds 1-60)</b></p>
    <input id="delay" type="number" min="1" max="60" value="10" />

    <p><b>Upload Message File (text, .txt or .csv) ‚Äî max 5 MB</b></p>
    <input id="file" type="file" accept=".txt,.csv" />
    <button onclick="upload()">üì§ Upload</button>
  </div>

  <div class="row">
    <button onclick="start()">üöÄ Start</button>
    <button onclick="stop()">üõë Stop</button>
    <button onclick="session()">üîë Session Info</button>
    <button onclick="health()">üìä Server Health</button>
    <button onclick="showGroups()">üë• Show Group UIDs</button>
    <button onclick="getLogs()">üìú Show Logs</button>
    <button onclick="download()">‚¨áÔ∏è Download Session File</button>
  </div>

  <pre id="output">Output will appear here.</pre>
  <div class="small" id="progress">No file uploaded.</div>
</div>

<script>
async function pair(){
  const number=document.getElementById("number").value;
  const res=await fetch("/pair",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({number})});
  const data=await res.json();
  out("Pairing code: "+data.pairingCode+"\n"+data.message);
}
async function upload(){
  const file=document.getElementById("file").files[0];
  if(!file){out("Choose a file first.");return;}
  const form=new FormData();form.append("file",file);
  const res=await fetch("/upload",{method:"POST",body:form});
  const data=await res.json();
  out(JSON.stringify(data,null,2));
  await session(); // refresh session info
}
async function start(){
  const payload={
    targetType:document.getElementById("targetType").value,
    targetValue:document.getElementById("targetValue").value,
    delay:document.getElementById("delay").value,
    prefix:document.getElementById("prefix").value
  };
  const res=await fetch("/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const data=await res.json();
  out(data.message+" Session ID: "+data.sessionId);
  await session();
}
async function stop(){
  const res=await fetch("/stop",{method:"POST"});const data=await res.json();out(data.message);await session();
}
async function session(){
  const res=await fetch("/session");const data=await res.json();
  out(JSON.stringify(data,null,2));
  document.getElementById("progress").innerText = `Total lines: ${data.totalLines}   Current index: ${data.currentIndex}   LastSentAt: ${data.lastSentAt || 'never'}`;
}
async function health(){
  const res=await fetch("/health");const data=await res.json();out(JSON.stringify(data,null,2));
}
async function showGroups(){
  const res=await fetch("/groupuids");
  const data=await res.json();
  out("Detected Group UIDs:\n" + (data.groupUIDs.length ? data.groupUIDs.join("\n") : "None found in file"));
}
async function getLogs(){
  const res=await fetch("/logs?n=200");
  const data=await res.json();
  out("Last logs (latest first):\n" + JSON.stringify(data.logs.reverse(), null, 2));
}
async function download(){
  window.location.href = "/download-sessions";
}
function out(t){document.getElementById("output").innerText=t;}
</script>
</body>
</html>
